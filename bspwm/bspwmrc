#!/bin/bash

# monitor settings
#bspc monitor -d I II III IV V VI VII VIII IX X
if [[ `xrandr -q | grep ' connected' | cut -d ' ' -f1 | grep HDMI2` == '' ]]; then
    bspc monitor -d 1 2 3 4 5
else
    xrandr --output HDMI2 --primary --mode 1920x1080 --rotate normal
    xrandr --output eDP1 --off
        #--output eDP1 --mode 1920x1080 --rotate normal --left-of HDMI2
    bspc monitor HDMI2 -d 1 2 3 4 5
    #bspc monitor eDP1 -d 6 7 8 9 10
fi

# window settings
bspc config border_width        1
bspc config window_gap          0

# split behaviour
bspc config split_ratio          0.50
bspc config borderless_monocle   true
bspc config gapless_monocle      false

# move pointer to focused monitor
bspc config pointer_follows_monitor true

# enable mouse?
bspc config click_to_focus       button1

# ensure that initial focus is on desktop 1
bspc desktop -f 1

# set keyboard layout mappings (must be set before sxhkd starts)
setxkbmap dvorak
setxkbmap -option caps:escape

# start sxhkd hotkey daemon
sxhkd &

# set screen lock hook
xss-lock -- i3lock -t -i $BACKGROUND_IMAGE_FILE &

# set background image
~/.fehbg &

# start polybar
$DOTFILES/polybar/polybar.sh

# set touchpad settings if xinput (and libinput) is installed
touchpad_id=`$DOTFILES/scripts/get_touchpad_id.py`
if [ $? -eq 0 ]; then
    xinput --set-prop $touchpad_id "libinput Tapping Enabled" 1
    xinput --set-prop $touchpad_id "libinput Natural Scrolling Enabled" 1
    xinput --set-prop $touchpad_id "libinput Disable While Typing Enabled" 1
fi

# set key repeat rate
xset r rate 185 40

# a hack to get dunst to start correctly
systemctl --user restart dunst

# *****************************
# Startup Applications
# *****************************

# start power manager
if [ `command -v xfce4-power-manager` ]; then
    xfce4-power-manager
fi

# start compton
if [ `command -v compton` ]; then
    compton --config $HOME/.config/compton/compton.conf -b
fi

# start NetworkManager applet
if [ `command -v nm-applet` ]; then
    nm-applet &
fi

if [ `command -v pasystray` ]; then
    pasystray &
fi
